package components

import "github.com/Francesco99975/authpoc/views/icons"

type SettingsNavProps struct {
	AppName   string
	Username  string
	Email     string
	Initials  string
	Role      string
	TwoFA     bool
	UserID    string
	Created   string
	LastLogin string
	CSRF      string
}

templ SettingsNav(props SettingsNavProps) {
	<header class="sticky top-0 z-50 bg-primary shadow-lg">
		<div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
			<div class="flex h-16 items-center justify-between">
				<!-- Logo -->
				<a href="/" class="flex items-center gap-3 group">
					<div class="transition-transform duration-300 group-hover:scale-110 group-hover:rotate-6 bg-std p-2 rounded-full">
						<div class="h-6 w-6 rounded-lg bg-primary flex items-center justify-center">
							<span class="text-xs font-bold text-white">A</span>
						</div>
					</div>
					<span class="text-xl font-bold text-white tracking-tight">{ props.AppName }</span>
				</a>
				<!-- Desktop Navigation -->
				<div class="hidden md:flex items-center gap-6">
					<nav class="flex items-center gap-1">
						<a
							href="/dashboard"
							hx-get="/dashboard"
							hx-push-url="true"
							hx-target="#main-content"
							hx-swap="innerHTML"
							class="relative px-4 py-2 text-white/80 font-medium rounded-lg transition-all duration-200 hover:bg-white/10 hover:text-white focus:outline-none focus:ring-2 focus:ring-accent/50 group"
						>
							<span class="relative z-10">Dashboard</span>
							<span class="absolute inset-x-0 bottom-0 h-0.5 bg-accent scale-x-0 group-hover:scale-x-100 transition-transform duration-200 origin-left"></span>
						</a>
						<a
							href="/settings"
							class="relative px-4 py-2 text-white font-medium rounded-lg bg-white/10 transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-accent/50"
						>
							<span class="relative z-10">Settings</span>
							<span class="absolute inset-x-0 bottom-0 h-0.5 bg-accent"></span>
						</a>
					</nav>
					<!-- User dropdown -->
					@UserDropdown(props)
				</div>
				<!-- Mobile Menu Button -->
				<button
					@click="mobileMenuOpen = !mobileMenuOpen"
					class="md:hidden p-2.5 rounded-lg bg-white/10 hover:bg-white/20 transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-accent/50"
				>
					<template x-if="!mobileMenuOpen">
						@icons.Hamburger("w-6 h-6 text-white")
					</template>
					<template x-if="mobileMenuOpen">
						@icons.Close("w-6 h-6 text-white")
					</template>
				</button>
			</div>
		</div>
		<!-- Mobile menu -->
		@MobileMenu(props)
	</header>
}

templ UserDropdown(props SettingsNavProps) {
	<div class="relative" x-data="{ open: false }">
		<button
			@click="open = !open"
			@click.away="open = false"
			class="flex items-center gap-3 px-3 py-2 rounded-xl bg-white/10 hover:bg-white/20 transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-accent/50"
		>
			<div class="h-8 w-8 rounded-full bg-linear-to-br from-accent to-primary flex items-center justify-center ring-2 ring-white/30">
				<span class="text-sm font-bold text-white">{ props.Initials }</span>
			</div>
			<span class="text-sm font-medium text-white">{ props.Username }</span>
			@icons.ChevronDown("w-4 h-4 text-white/70 transition-transform duration-200 :class=\"open ? 'rotate-180' : ''\"")
		</button>
		<!-- Dropdown Menu -->
		<div
			x-show="open"
			x-transition:enter="transition ease-out duration-200"
			x-transition:enter-start="opacity-0 scale-95 -translate-y-2"
			x-transition:enter-end="opacity-100 scale-100 translate-y-0"
			x-transition:leave="transition ease-in duration-150"
			x-transition:leave-start="opacity-100 scale-100 translate-y-0"
			x-transition:leave-end="opacity-0 scale-95 -translate-y-2"
			class="absolute right-0 mt-2 w-72 rounded-xl bg-std shadow-2xl border border-primary/10 overflow-hidden"
			x-cloak
		>
			<!-- User Info Section -->
			<div class="p-4 bg-primary/5 border-b border-primary/10">
				<div class="flex items-center gap-3">
					<div class="h-12 w-12 rounded-full bg-linear-to-br from-accent to-primary flex items-center justify-center ring-2 ring-primary/20">
						<span class="text-lg font-bold text-white">{ props.Initials }</span>
					</div>
					<div class="min-w-0 flex-1">
						<p class="text-sm font-semibold text-primary truncate">{ props.Username }</p>
						<p class="text-xs text-primary/60 truncate">{ props.Email }</p>
					</div>
				</div>
				<div class="mt-3 flex items-center gap-2">
					@RoleBadge(props.Role)
					if props.TwoFA {
						<span class="inline-flex items-center gap-1 rounded-full bg-success/10 px-2.5 py-1 text-xs font-medium text-success">
							@icons.Shield("w-3 h-3")
							2FA Enabled
						</span>
					}
				</div>
			</div>
			<!-- Account Details -->
			<div class="p-3 space-y-1 border-b border-primary/10">
				<div class="flex items-center justify-between px-2 py-1.5">
					<span class="text-xs text-primary/60">User ID</span>
					<span class="text-xs font-mono text-primary">{ props.UserID }</span>
				</div>
				<div class="flex items-center justify-between px-2 py-1.5">
					<span class="text-xs text-primary/60">Member since</span>
					<span class="text-xs text-primary">{ props.Created }</span>
				</div>
				<div class="flex items-center justify-between px-2 py-1.5">
					<span class="text-xs text-primary/60">Last login</span>
					<span class="text-xs text-primary">{ props.LastLogin }</span>
				</div>
			</div>
			<!-- Logout Button -->
			<div class="p-2">
				<form
					hx-post="/auth/logout"
					hx-indicator="#logout-indicator"
					hx-disabled-elt="find button"
				>
					<input type="hidden" name="csrf" value={ props.CSRF }/>
					<button type="submit" class="w-full flex items-center justify-center gap-2 px-4 py-2.5 rounded-lg bg-error text-white font-semibold text-sm hover:bg-error/90 transition-all duration-200 relative">
						<span class="flex items-center gap-2">
							@icons.LogOut("w-4 h-4")
							Logout
						</span>
						<div id="logout-indicator" class="htmx-indicator absolute inset-0 flex items-center justify-center bg-error rounded-lg">
							@icons.Loading("w-5 h-5 text-white animate-spin")
						</div>
					</button>
				</form>
			</div>
		</div>
	</div>
}

templ MobileMenu(props SettingsNavProps) {
	<div
		x-show="mobileMenuOpen"
		x-transition:enter="transition ease-out duration-200"
		x-transition:enter-start="opacity-0 -translate-y-4"
		x-transition:enter-end="opacity-100 translate-y-0"
		x-transition:leave="transition ease-in duration-150"
		x-transition:leave-start="opacity-100 translate-y-0"
		x-transition:leave-end="opacity-0 -translate-y-4"
		class="md:hidden bg-primary/95 backdrop-blur-md border-t border-white/10"
		x-cloak
	>
		<div class="px-4 py-5 space-y-4">
			<!-- User Info -->
			<div class="flex items-center gap-3 p-3 rounded-xl bg-white/10">
				<div class="h-12 w-12 rounded-full bg-linear-to-br from-accent to-primary flex items-center justify-center ring-2 ring-white/30">
					<span class="text-lg font-bold text-white">{ props.Initials }</span>
				</div>
				<div class="min-w-0 flex-1">
					<p class="text-sm font-semibold text-white truncate">{ props.Username }</p>
					<p class="text-xs text-white/60 truncate">{ props.Email }</p>
					<div class="mt-1 flex items-center gap-2">
						@RoleBadgeMobile(props.Role)
					</div>
				</div>
			</div>
			<!-- Navigation Links -->
			<nav class="space-y-1">
				<a
					href="/dashboard"
					hx-get="/dashboard"
					hx-push-url="true"
					hx-target="#main-content"
					hx-swap="innerHTML"
					class="flex items-center gap-3 px-4 py-3 text-white/80 font-medium rounded-lg hover:bg-white/10 hover:text-white transition-all duration-200"
				>
					@icons.Home("w-5 h-5")
					Dashboard
				</a>
				<a
					href="/settings"
					class="flex items-center gap-3 px-4 py-3 text-white font-medium rounded-lg bg-white/10 transition-all duration-200"
				>
					@icons.Cog("w-5 h-5")
					Settings
				</a>
			</nav>
			<!-- Logout Button -->
			<form
				hx-post="/auth/logout"
				hx-indicator="#mobile-logout-indicator"
				hx-disabled-elt="find button"
				class="pt-2"
			>
				<input type="hidden" name="csrf" value={ props.CSRF }/>
				<button type="submit" class="w-full flex items-center justify-center gap-2 px-4 py-3.5 rounded-lg bg-error text-white font-semibold hover:bg-error/90 transition-all duration-200 relative">
					<span class="flex items-center gap-2">
						@icons.LogOut("w-5 h-5")
						Logout
					</span>
					<div id="mobile-logout-indicator" class="htmx-indicator absolute inset-0 flex items-center justify-center bg-error rounded-lg">
						@icons.Loading("w-5 h-5 text-white animate-spin")
					</div>
				</button>
			</form>
		</div>
	</div>
}

templ RoleBadge(role string) {
	switch role {
		case "DEVELOPER":
			<span class="inline-flex items-center rounded-full bg-accent/20 px-2.5 py-1 text-xs font-semibold text-accent">{ role }</span>
		case "ADMIN":
			<span class="inline-flex items-center rounded-full bg-warning/20 px-2.5 py-1 text-xs font-semibold text-warning">{ role }</span>
		default:
			<span class="inline-flex items-center rounded-full bg-primary/20 px-2.5 py-1 text-xs font-semibold text-primary">{ role }</span>
	}
}

templ RoleBadgeMobile(role string) {
	switch role {
		case "DEVELOPER":
			<span class="inline-flex items-center rounded-full bg-accent/30 px-2 py-0.5 text-xs font-medium text-white">{ role }</span>
		case "ADMIN":
			<span class="inline-flex items-center rounded-full bg-warning/30 px-2 py-0.5 text-xs font-medium text-white">{ role }</span>
		default:
			<span class="inline-flex items-center rounded-full bg-white/30 px-2 py-0.5 text-xs font-medium text-white">{ role }</span>
	}
}
